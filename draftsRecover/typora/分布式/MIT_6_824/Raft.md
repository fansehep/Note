- 2A Leader electron

  Raft 使用一种心跳机制来触发领导人选举.

  1. 当服务器程序启动时, 他们都是follower. 
  2. 领导人周期性的向所有跟随者发送心跳包. 来确认leader 还活着.
  3. 如果一个跟随者在一段时间内没有受到任何消息. 那么它就会认为当前系统中没有可用的领导人, 并且发起选举以选出新的领导人.

  开始一次选举过程

  1. follower 需要增加自己的当前任期号, 并且他会并行的向集群中的其他服务器节点发送请求投票的 RPC 来给自己投票. 候选人会继续保持着当前状态直到以下三件事情之一发生

     - 它赢得了此次选举
     - 其他服务器成为领导人
     - 一段时间之后没有任何一个获胜的人

  2. 每一个服务器**最多只会对一个任期号投出一张选票**.按照先来先服务的原则.一旦候选人赢得选举, 他就立即成为领导人. 然后他会向其他的服务器发送心跳消息并阻止新的选举.

     在等待投票的时候, 候选人可能会从其他的服务器接收到声明他是领导人的附加条目(AppendEntries) RPC, 如果这个领导人的任期号 > 当前的候选人,
  
  3. 候选人既没有赢得选举也没有输，如果有多个跟随者都同时成为候选人，那么选票可能会被瓜分以至于没有候选人可以赢得本次选举，那么当这种情况的时候，每一个候选人都会超时，然后，又开始增加当前的任期号来开始新的一轮选举。然后，没有其他机制的话，选票可能会被无限重复瓜分。
  
  4. raft 算法 使用 **随机选举超时时间** 的方法来确保很少会发生选票瓜分的情况。
  
     - 选举超时时间是从一个固定的区间 (150 - 300ms) 的随机选择. 