#### 确保Web安全的HTTPS

- 在HTTP协议中，有可能存在信息窃听或身份伪装等安全问题。

- 万事都有两面性，HTTP主要有这些不足

  - 1. 通信使用明文 ( 无加密 )，内容可能会被窃听
    2. 不验证通信方的身份，因此有可能遭遇伪装
    3. 无法证明报文的完整性，所以有可能已经遭受篡改
  - 通信明文可能会被窃听
  
    - TCP / IP 是可能被窃听的网络
      - 按照TCP / IP 协议族的工作机制，通信内容在所有的通信线路上都有可能遭到窥视。
      - 即使已经加密的信息。也可能会被窥视到通信内容。
    - 通信的加密
      - HTTP 协议中没有加密机制，但可以通过和 SSL ( Secure Socket Layer, 安全套接层 ) 或 TLS ( Transport Layer Security , 安全层传输协议 )的组合使用，加密HTTP的通信内容。
      - 用 SSL 建立安全通信线路之后。就可以在这条线路上进行 HTTP 通信了。与 SSL 组合使用的 HTTP 被称为 HTTPS ( HTTP Secure , 超文本传输安全协议 ) 或者 HTTP over SSL
    - 内容的加密
      - 将参与通信的内容本身加密。
      - 对此，客户端和服务器同时具备加密和解密机制。
  - 不验证通信方的身份就可能遭遇伪装

    - 任何人都可以发起请求。

      - 在 HTTP 协议中。任何人都可以发起请求。不管对方是谁，都会返回一个响应。
      - 因此不确定通信方
        - 1. 无法确定请求发送至目标的 Web 服务器是狗按照真实意图返回的响应的那台服务器。
          2. 无法确定响应返回到的客户端是否是按真实意图接受响应的那个客户端。有可能是已伪装的客户端。
          3. 无法确定正在通信的对方是否具备访问权限。因为某些 Web 服务器上保存着重要的信息。
          4. 无法判定请求是来自何方
          5. 即使是无意义的请求也会照单全收。无法阻止海量请求下的 Dos 攻击。
  
    - 查明对手的证书

      - 虽然使用 HTTP 协议无法确定通信方，但如果使用 SSL 则可以。SSL不仅提供加密处理。还使用了证书手段。
      - 证书由值得信任的第三方机构颁发，用来证明服务器和客户端是实际存在的。另外，伪造证书是十分困啊的。
      - 通过使用证书，以证明通信方就是意料中的服务器。
  
    - 无法证明报文完整性，可能已经遭受篡改

      - 接受的内容可能有误
        - 由于 HTTP 协议无法证明通信的报文完整性，因此，在请求或响应送出之后知道对方接受之前的这段时间内，即使请求或响应的内容遭到篡改。也没有办法。
      - 如何防止篡改
        - 常用的是 MD5 和 SHA - 1 等散列值校验的方法。以及用来确认文件的数字签名方法。
        - 但实际上，这些方法依然无法百分百保证确认结果正确。
  
    - HTTP +  加密 + 认证 + 完整性保护  = HTTPS

      - HTTPS 是身披SSL外壳 的 HTTP
        - https 并不是应用层的一种新协议。只是HTTP通信接口部分用 SSL ( Secure Socket Layer ) 和 TLS ( Transport Layer Security ) 协议代替而已。
      - SSL 是独立于 HTTP 的协议，不光是 HTTP 协议，其他运行在应用层的 SMTP 和 Telnet 等协议均可配合 SSL 协议使用。
  
    - 相互交换密钥的公开密钥加密技术

      - SSL 采用的是一种叫做 公开密钥加密 ( Public - Key crytography ) 的加密处理方式

      - 近代的加密方法中加密算法是公开的，但是密钥确实保密的。通过这种方式得以保持加密方法的安全性

        - 共享密钥加密的困境

          - 加密和解密共用一个密钥的方式称为 共享密钥加密 ( Common Key crypto system ), 也被叫做对称密钥加密
          - 以共享密钥加密时，必须将密钥传给对方。可究竟怎样才能安全转交？
  
        - 使用两把密钥的公开密钥加密

          - 公开密钥加密使用一种非对称的密钥。

            - 一把是 private key 似有密钥

            - 一把是 public key 共有密钥

            - 似有 密钥不能让其他人知道，而公开密钥则可以随意发布。

            - 非对称加密需要 public key 和 private key

              - public key and private key 是一对。
                - 使用共有密钥对数据进行加密时，只有配对的似有密钥才能破解。反之亦然。
                - 因为加密和解密使用的是两个不同的密钥，所以这种算法叫做非对称加密算法。
  
            - 我们来模拟一下 非对称加密算法的 流程

              - 客户端和服务端各持有自己的共钥和私钥
                - 客户端使用服务器的共钥对自己的数据进行加密。
                - 服务器收到之后，采用私钥解密
                - 这样就不用担心密钥被攻击者窃听而盗走。
              - 但是呢这不过是一种 Trade off 罢了
                - 若密钥能够实现安全交换，那么有可能会仅考虑使用公开的密钥进行加密来通信。
                - 所以应充分利用两者各自的优势。将多种方法1用于通信。在交换密钥环节使用公开密钥加密方式，之后建立通信交换报文阶段则使用共享密钥加密方式。
              - ![](https://raw.githubusercontent.com/fansehep/img_HMStrange/master/2022-01-01%2011-09-59%20%E7%9A%84%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png)
  -  证明共开密钥正确性的证书
    - 公开密钥加密方式还是存在一些问题的。那就是无法证明公开密钥本身就是货真价实的公开密钥。
      - 比如，正准备和某个服务器建立公开密钥加密的方式的通信时。如何证明收到的公开密钥就是原本预想的那台服务器发行的公开密钥。可能在公开密钥传输途中，真正的公开密钥已经被攻击者替换掉了。
	    - 为了解决上述问题，可以使用 数字证书认证机构 ( CA, Certificate Authority )和其相关机关颁发的公开密钥证书
      - 多数浏览器和操作系统会事先在内部植入常用的认证机关的公开密钥
  
    - 可证明组织真实性的 EV SSL 证书
      - 证书的作用
        - 证明通信一方的服务器是否规范
        - 另一个作用就是确认对方服务器背后运营的企业是否真实存在。
  
      - EV SSL 证书是基于国际标准的认证指导方针颁发的证书。其严格规定了对运营组织是否真实的确认方针。
  
    - 用以确认客户端的客户端证书
      - 安全性极高的认证机构可颁发客户端证书但仅用于特殊用途的业务。比如那些可支撑客户端证书支出费用的业务。
  
  
  
  
  HTTPS 的安全通信机制
  
  ![](https://raw.githubusercontent.com/fansehep/img_HMStrange/master/2022-01-01%2011-27-18%20%E7%9A%84%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png)
  
  ![](https://raw.githubusercontent.com/fansehep/img_HMStrange/master/2022-01-01%2011-30-13%20%E7%9A%84%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png)
  
  - SSL 和 TLS
    -  SSL 技术最初由浏览器开发商网景开发。后来转交了IETF
    - IETF 以 SSL 3.0 为基准。先后制定了 TLS1.0, TLS 1.1 和 TLS 1.2.
      - 我们大多数时候统一称该协议为 SSL
  - 为什么不一直使用 HTTPS 
    - SSL 比较慢。一是通信慢，二是大量消耗 CPU 和 内存等资源。导致处理速度变慢。
    - SSL 必须进行加密处理。在服务器和客户端都需要进行加密和解密的运算处理
    - 所以一般是非敏感信息才使用 HTTP 通信。只有在包含个人信息等敏感数据时。才利用 HTTPS 加密通信。
  - 
  
  ​	
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  ​            
  
  ​            



























































